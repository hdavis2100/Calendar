<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calculator</title>
    <link rel="stylesheet" href="styles.css"/>

</head>
<body>
    <div id="loginForm">
    <label for="usernameinput">Username:</label>
    <input type="text" name="username" id="usernameinput" />
    <label for="passwordinput"> Password</label>
    <input type="password" name="password" id="passwordinput" />
    <button id="loginbutton">Login</button>
    </div>

    <div id="createAccountForm">
    <label for="createAccount">Create Account:</label>
    <input type="text" name="createAccountUsername" id="createAccountUsername" />
    <label for="createAccountPassword"> Password</label>
    <input type="password" name="createAccountPassword" id="createAccountPassword" />
    <button id="createAccountButton">Create Account</button>
    </div>
    
    <div id="logoutForm">
    <label for="logoutButton">Logout:</label>
    <button id="logoutButton">Logout</button>
    </div>
    

    <label id="calendarLabel" for="calendar"></label>
    <table id="calendar">
        <thead>
            <tr>
                <th>Sun</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
            </tr>
        </thead>
        <tbody id="calBody">
            
        </tbody>
        <button id="prev_month_btn">Previous Month</button>
        <button id="next_month_btn">Next Month</button>

    </table>
</body>
</html>
<script src="calendarMin.js"></script>

<script>
        // For our purposes, we can keep the current month in a variable in the global scope
    let currentMonth = new Month(new Date().getFullYear(), new Date().getMonth()); // Current month

    // Change the month when the "next" button is pressed
    document.getElementById("next_month_btn").addEventListener("click", function(event){
        currentMonth = currentMonth.nextMonth(); // Previous month would be currentMonth.prevMonth()
        updateCalendar(); // Whenever the month is updated, we'll need to re-render the calendar in HTML
        
    }, false);
    
    document.getElementById("prev_month_btn").addEventListener("click", function(event){
        currentMonth = currentMonth.prevMonth(); 
        updateCalendar(); 
        
    }, false);


    // This updateCalendar() function only alerts the dates in the currently specified month.  You need to write
    // it to modify the DOM (optionally using jQuery) to display the days and weeks in the current month.
    function updateCalendar(){
        document.getElementById("calendarLabel").innerText = currentMonth.month + " " + currentMonth.year;
        let weeks = currentMonth.getWeeks();
        let calBody = document.getElementById("calBody");
        calBody.innerHTML = ""; 

        for(var w in weeks){
            var days = weeks[w].getDates();
            
            const row = document.createElement("tr");

            
            
            for(var d in days){
                const cell = document.createElement("td");
                cell.innerText = days[d].getDate();
                row.appendChild(cell);
                
            }
            calBody.appendChild(row);
        }
    }
    let setContent = function() {
        
        fetch("setContent.php", {
            method: 'GET',
            headers: { 'content-type': 'application/json' }
        
        })
        .then(response => response.json())
        .then(data => {
            if(data.success) {
                document.getElementById("loginForm").hidden = true;
                document.getElementById("createAccountForm").hidden = true;
                document.getElementById("logoutForm").hidden = false;
                

                
            } 
            else {
                document.getElementById("loginForm").hidden = false;
                document.getElementById("usernameinput").value = "";
                document.getElementById("passwordinput").value = "";
                document.getElementById("createAccountUsername").value = "";
                document.getElementById("createAccountPassword").value = "";
                document.getElementById("createAccountForm").hidden = false;

                document.getElementById("logoutForm").hidden = true;
            }
            updateCalendar();
        })
        .catch(error => console.error('Error:',error))
    };
    document.addEventListener("DOMContentLoaded", setContent, false);

    let login = function() {
        const username = document.getElementById("usernameinput").value;
        const password = document.getElementById("passwordinput").value;
        const data = { 'username': username, 'password': password };
        fetch("login.php", {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'content-type': 'application/json' }
        
        })
        .then(response => response.json())
        .then(data => console.log(data.success ? "You've been logged in!" : `You were not logged in ${data.message}`))
        .then( () => setContent())
        .catch(error => console.error('Error:',error))
        

    };
    
    let createAccount = function() {
        const username = document.getElementById("createAccountUsername").value;
        const password = document.getElementById("createAccountPassword").value;
        const data = { 'username': username, 'password': password };
        fetch("storeNewUser.php", {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'content-type': 'application/json' }
        
        })
        .then(response => response.json())
        .then(data => console.log(data.success ? "Account created successfully!" : `Account creation failed: ${data.message}`))
        .then( () => setContent())
        .catch(error => console.error('Error:',error))
        

    };

    let logout = function() {
        fetch("logout.php", {
            method: 'POST',
            headers: { 'content-type': 'application/json' }
        
        })
        .then(response => response.json())
        .then(data => console.log(data.success ? "You've been logged out!" : `You were not logged out ${data.message}`))
        .then( () => setContent())
        .catch(error => console.error('Error:',error))
        

    };
    document.getElementById("loginbutton").addEventListener("click", login, false);
    document.getElementById("createAccountButton").addEventListener("click", createAccount, false);
    document.getElementById("logoutButton").addEventListener("click", logout, false);
    

</script>